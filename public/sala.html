<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sala Global</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    header {
      background-color: #2a2a2a;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #usuarios {
      background-color: #2a2a2a;
      padding: 1rem;
      position: absolute;
      top: 0;
      right: 0;
      width: 250px;
      height: 100%;
      overflow-y: auto;
      display: none;
    }
    #chat {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background-color: #1e1e1e;
    }
    form {
      display: flex;
      gap: 0.5rem;
      padding: 1rem;
      background-color: #2a2a2a;
      align-items: center;
    }
    input[type="text"] {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
    }
    button, label[for="imagemInput"] {
      background-color: #4caf50;
      border: none;
      padding: 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      color: white;
      font-size: 1rem;
    }
    button:hover, label[for="imagemInput"]:hover {
      background-color: #45a049;
    }
    #imagemInput {
      display: none;
    }
    .usuario-item {
      cursor: pointer;
      color: #4fc3f7;
      text-decoration: underline;
      margin-bottom: 0.5rem;
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <h2>Sala Global</h2>
    <button id="toggleUsuarios">Usuários</button>
  </header>
  <div id="usuarios">
    <button id="fecharUsuarios">Fechar</button>
    <h3>Usuários Online</h3>
    <ul id="listaUsuarios"></ul>
  </div>
  <div id="chat"></div>
  <form id="form">
    <input type="text" id="mensagem" placeholder="Digite sua mensagem" autocomplete="off" />
    <label for="imagemInput" title="Enviar imagem">🖼️</label>
    <input type="file" id="imagemInput" accept="image/*">
    <button type="submit">Enviar</button>
  </form>  <script src="/socket.io/socket.io.js"></script>   <script>     const socket = io();     const chat = document.getElementById('chat');     const form = document.getElementById('form');     const mensagemInput = document.getElementById('mensagem');     const imagemInput = document.getElementById('imagemInput');     const listaUsuarios = document.getElementById('listaUsuarios');     const toggleUsuarios = document.getElementById('toggleUsuarios');     const fecharUsuarios = document.getElementById('fecharUsuarios');

    const urlParams = new URLSearchParams(window.location.search);     const username = urlParams.get('username') || 'Anônimo';

    let usuariosOnline = [];

    socket.emit('usuario_entrando', username);

    toggleUsuarios.onclick = () => {       document.getElementById('usuarios').style.display = 'block';     };     fecharUsuarios.onclick = () => {       document.getElementById('usuarios').style.display = 'none';     };

    form.addEventListener('submit', e => {       e.preventDefault();       const texto = mensagemInput.value.trim();       if (texto) {         socket.emit('mensagem', { nome: username, texto });         mensagemInput.value = '';       }     });

    imagemInput.addEventListener('change', () => {       const file = imagemInput.files[0];       if (!file) return;       const reader = new FileReader();       reader.onload = () => {         socket.emit('imagem', { nome: username, imagem: reader.result });       };       reader.readAsDataURL(file);     });

    socket.on('usuarios_online', nomes => {       usuariosOnline = nomes;       listaUsuarios.innerHTML = '';       nomes.forEach(nome => {         const li = document.createElement('li');         li.textContent = nome;         li.classList.add('usuario-item');         li.onclick = () => {           mensagemInput.value += @${nome} ;           mensagemInput.focus();         };         listaUsuarios.appendChild(li);       });     });

    socket.on('mensagem', data => {       const div = document.createElement('div');       let texto = data.texto;       usuariosOnline.forEach(nome => {         const regex = new RegExp(@${nome}\\b, 'g');         texto = texto.replace(regex, <strong style="color:#ffd54f">@${nome}</strong>);       });       div.innerHTML = <strong>${data.nome}:</strong> ${texto};       chat.appendChild(div);       chat.scrollTop = chat.scrollHeight;     });

    socket.on('imagem', data => {       const div = document.createElement('div');       div.innerHTML = <strong>${data.nome}:</strong> <br><img src="${data.imagem}" alt="imagem" style="max-width: 200px; display:block;" /><button onclick="this.previousElementSibling.style.display=this.previousElementSibling.style.display==='none'?'block':'none'">Ver/Ocultar</button>;       chat.appendChild(div);       chat.scrollTop = chat.scrollHeight;     });   </script>

</body>
</html>
