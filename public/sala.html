<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>New Community Chat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }body {
  background-color: #121212;
  color: #ffffff;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.chat-header {
  padding: 1rem;
  background-color: #1e1e1e;
  border-bottom: 1px solid #444;
  text-align: center;
  font-weight: bold;
}

#chat {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  background-color: #ccc; /* cinza claro */
  color: #000;
}

#chat div {
  margin-bottom: 0.75rem;
  line-height: 1.4;
}

.chat-form {
  display: flex;
  flex-direction: column;
  padding: 0.75rem;
  background-color: #1e1e1e;
  gap: 0.5rem;
}

.chat-form input[type="text"] {
  padding: 0.5rem;
  border-radius: 5px;
  border: none;
  outline: none;
  background: #333;
  color: white;
}

.chat-form .buttons {
  display: flex;
  gap: 0.5rem;
}

.chat-form button,
#btnAudio,
#btnArquivo,
#btnCor,
#btnFontes {
  padding: 0.5rem;
  border: none;
  background: #4caf50;
  color: white;
  border-radius: 5px;
  cursor: pointer;
  flex: 1;
}

select, input[type="file"] {
  padding: 6px;
  border-radius: 5px;
  border: none;
  background-color: #333;
  color: white;
  font-size: 0.9rem;
}

#usuariosContainer {
  display: none;
  position: absolute;
  top: 60px;
  right: 10px;
  background: #1e1e1e;
  border: 1px solid #333;
  padding: 1rem;
  border-radius: 8px;
  z-index: 10;
  width: 80vw;
  max-width: 250px;
}

.chat-img {
  max-width: 100%;
  border-radius: 6px;
  margin-top: 5px;
}

  </style>
</head>
<body>
  <div class="chat-header">
    New Community
    <button onclick="toggleUsuarios()">Usuários</button>
  </div>  <div id="usuariosContainer"></div>
  <div id="chat"></div>  <form id="form" class="chat-form">
    <input id="mensagem" type="text" placeholder="Digite sua mensagem..." autocomplete="off" />
    <div class="buttons">
      <button type="submit">Enviar</button>
      <button type="button" id="btnAudio">Microfone</button>
      <button type="button" id="btnArquivo">Clips</button>
      <button type="button" id="btnCor">Cor</button>
      <button type="button" id="btnFontes">Fonte</button>
    </div>
    <input type="file" id="inputArquivo" accept="image/*,audio/*" style="display:none;" />
  </form>  <script src="/socket.io/socket.io.js"></script>  <script>
    const socket = io();
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get("username") || "Anônimo";

    const form = document.getElementById("form");
    const input = document.getElementById("mensagem");
    const chat = document.getElementById("chat");
    const inputArquivo = document.getElementById("inputArquivo");
    const usuariosContainer = document.getElementById("usuariosContainer");

    let userColor = localStorage.getItem("userColor") || "#000000";
    let userFont = localStorage.getItem("userFont") || "Inter";

    function toggleUsuarios() {
      usuariosContainer.style.display = usuariosContainer.style.display === 'block' ? 'none' : 'block';
    }

    document.getElementById("btnArquivo").addEventListener("click", () => inputArquivo.click());

    inputArquivo.addEventListener("change", () => {
      const file = inputArquivo.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          socket.emit("imagem", { username, imagem: reader.result });
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById("btnCor").addEventListener("click", () => {
      const cor = prompt("Digite uma cor hexadecimal:", userColor);
      if (cor) {
        userColor = cor;
        localStorage.setItem("userColor", cor);
      }
    });

    document.getElementById("btnFontes").addEventListener("click", () => {
      const fonte = prompt("Digite a fonte (ex: 'Courier New', 'Comic Sans MS', 'Times New Roman', 'Arial Black'):", userFont);
      if (fonte) {
        userFont = fonte;
        localStorage.setItem("userFont", fonte);
      }
    });

    form.addEventListener("submit", e => {
      e.preventDefault();
      const texto = input.value.trim();
      if (texto) {
        socket.emit("mensagem", { username, texto, fonte: userFont, cor: userColor });
        input.value = "";
      }
    });

    socket.on("mensagem", ({ username: autor, texto, fonte, cor }) => {
      const div = document.createElement("div");
      div.innerHTML = `<strong>${autor}:</strong> <span style="font-family:${fonte}; color:${cor};">${texto}</span>`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    });

    socket.on("imagem", ({ username: autor, imagem }) => {
      const div = document.createElement("div");
      div.innerHTML = `<strong>${autor}:</strong><br><img src="${imagem}" class="chat-img" onclick="this.style.display=this.style.display==='none'?'block':'none';" />`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    });

    socket.on("usuarios", (lista) => {
      usuariosContainer.innerHTML = `<strong>Usuários online:</strong><ul>${lista.map(u => `<li>${u}</li>`).join('')}</ul>`;
    });

    window.addEventListener("resize", () => {
      chat.scrollTop = chat.scrollHeight;
    });
  </script></body>
</html>
